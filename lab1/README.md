
# –õ–∞–±–∞ ‚Ññ1 - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx

### –î–ª—è –Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –æ—Ç –Ω–∞—Å —Ö–æ—Ç—è—Ç

#### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–∏–Ω—Ç—ã:

- Nginx –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ https c —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ—Ä—Ç 80) –Ω–∞ HTTPS (–ø–æ—Ä—Ç 443) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å alias –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ö–æ—Å—Ç—ã –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
- –ß—Ç–æ —É–≥–æ–¥–Ω–æ –µ—â–µ –ø–æ–¥ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (optional)


## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–£ –Ω–∞—Å –µ—Å—Ç—å –≤—ã–±–æ—Ä: –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω–æ. 

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤—ã–±–æ—Ä –ø–∞–ª –Ω–∞ –∞—Ä–µ–Ω–¥—É —Å–µ—Ä–≤–µ—Ä–∞ (–æ—Ç [—Ç–∞–π–º.–≤–µ–±](https://timeweb.cloud/))
![](/lab1/media/time_web.png)
–ü–æ—Å–ª–µ –∞—Ä–µ–Ω–¥—ã —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å–µ–±–µ –≤—Ç–æ—Ä–æ–π –∞–π–ø–∏—à–Ω–∏–∫ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º `–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ö–æ—Å—Ç—ã –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ`

![](/lab1/media/ips.png)

–î–∞–ª–µ–µ –∑–∞—Ö–æ–¥–∏–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –µ–≥–æ (–¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ/–∫–æ–Ω—Å–æ–ª–µ):

–ó–∞—Ö–æ–¥–∏–º –Ω–∞ —Å–∞–º —Å–µ—Ä–≤–∞–∫: –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ ssh `ssh root@server_ip` –∏ –≤–≤–æ–¥–∏–º Root-–ø–∞—Ä–æ–ª—å `**********` (–ø–æ–ø–∞–¥–∞–µ–º –≤ ~/root/)

#### –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã 
```bash
apt update && apt install nginx 
```
#
–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç -

–Ω—É... –æ–Ω–æ –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ

–í—Å–µ –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –≤—ã–∫–ª—é—á–µ–Ω –ª–∏–±–æ –ø–æ—Ä—Ç –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `sudo lsof -i :80`. –ò –≤–∏–¥–∏–º —á—Ç–æ –∞–ø–∞—á–µ the second –º–µ—à–∞–µ—Ç. –°–Ω–æ—Å–∏–º –µ–≥–æ `systemctl stop apache2` –ø–æ—Å–ª–µ —á–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –µ–≥–æ –Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å `nginx -t` –∏ –µ—Å–ª–∏ –≤—Å–µ –≥—É–¥, —Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º—Å—è —Å–Ω–æ–≤–∞ `systemctl restart nginx`
![](/lab1/media/welcome.png)
omg
#
### –°–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
#### –°–æ–∑–¥–∞–µ–º ssh –∫–ª—é—á –∏ –∫–æ–ø–∏—Ä—É–µ–º –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –∫ —Å–µ–±–µ –Ω–∞ –≥–∏—Ç—Ö–∞–± –∏ –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø—É
```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com" #generation WOW
cat ~/.ssh/id_rsa.pub #–≤—ã–¥–µ–ª—è–µ–º –∫–ª—é—á –∏ ‚åò+C
git clone git@github.com:nick/repo.git
```
–í –æ–±—â–µ–º, –≤—Å–µ —É –Ω–∞—Å –≤ —Ä—É—Ç–µ, –∞ –ø–æ—ç—Ç–æ–º—É –º—ã –¥–æ–ª–∂–Ω—ã —Å–¥–µ–ª–∞—Ç—å –æ—á –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–æ–º–µ–Ω—Ç, –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ `root` –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–Ω—Ñ–∏–≥–µ –∏ –µ—â–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `location/` (–∞ —Ç–æ –±—É–¥–µ—Ç –Ω–µ–Ω–∞—Ö–æ–¥) 


![](/lab1/media/root.png)
#### add `location/` to our own `nginx.conf` 
![](/lab1/media/location.png)

## Set SSL cert
### –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
sudo mkdir /etc/nginx/ssl
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/nginx/ssl/nginx.key \
  -out /etc/nginx/ssl/nginx.crt
```
#
–í–≤–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ
```bash
Country Name (2 letter code) [AU]: RU
State or Province Name (full name) [Some-State]: Saint-Petersburg
Locality Name (eg, city) []: Saint-Petersburg
Organization Name (eg, company) [Internet Widgits Pty Ltd]: ITMO
Organizational Unit Name (eg, section) []: IT
Common Name (e.g. server FQDN or YOUR name) []: ip-address
Email Address []: some@mail.ru
```

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ –∏—Ö –≤ —Ä–µ–ø—É
```bash
sudo mkdir /root/repo/lab/web_server/ssl
sudo mv /etc/nginx/ssl/nginx.crt /root/repo/lab1/web_server/ssl/nginx.crt
sudo mv /etc/nginx/ssl/nginx.key /root/repo/lab1/web_server/ssl/nginx.key
```

#
–° —Å–µ—Ä–≤–∞–∫–æ–º —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å. –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–Ω—è—Ç—å —á—Ç–æ –º—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è –¥–µ–ø–ª–æ–∏—Ç—å.

–†–µ—à–∏–ª–∏ –Ω–µ –∑–∞–º–æ—Ä–∞—á–∏–≤–∞—Ç—Å—è –∏ —Å–¥–µ–ª–∞–ª–∏ –¥–≤–∞ so ezz html

`first.html`
```html
<html>
    <head>
        <title>first page</title>
    </head>
    <body>
        <meta charset="utf-8">
        <h1>(The) First Page</h1>
       <p1>—ç—Ç–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</p1>
    </body>
</html>
```
#
`second.html`
```html
<html>
    <head>
        <title>first page</title>
    </head>
    <body>
        <meta charset="utf-8">
        <h1>(The) Second Page</h1>
       <p1>—ç—Ç–æ –≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</p1>
    </body>
</html>
```


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞

#### –±–µ—Ä–µ–º [–±–∞–∑—É](https://timeweb.cloud/) –¥–ª—è –Ω–∞—à–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞, –∏ —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –æ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞ –æ–ª–µ–≥–∞ —Å–æ–±–∏—Ä–∞–µ–º –µ–≥–æ –ø–æ–¥ —Å–µ–±—è
—Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª–∏–∫ –≤ –Ω–∞—à–µ–π —Ä–µ–ø–µ 
```bash
nano /root/repo/lab/web_server/nginx.conf
``` 
#
`nginx.conf` 
```nginx
server {
#redirect‚úàÔ∏è
    listen 80;
    server_name 147.45.106.50;

    return 301 https://$host$request_uri;
}

server {
#–ß–∏—Ç–∞–µ–º
    listen 443 ssl;
    server_name 147.45.106.50;

#—É–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∏ –∫–ª—é—á—É 
    ssl_certificate /root/Itmo-DevOps-Cloud/lab1/web_server/ssl/nginx.crt;
    ssl_certificate_key /root/Itmo-DevOps-Cloud/lab1/web_server/ssl/nginx.key;

#–∫—Ä–æ–¥–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É html —Ñ–∞–π–ª—É
    location / {
        alias /root/Itmo-DevOps-Cloud/lab1/site1/;
        index first.html;
    }

#—Å–æ–±–∏—Ä–∞–µ–º –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
    error_log /root/Itmo-DevOps-Cloud/lab1/logs/site1_error.log;
}

server {  
#redirect‚úàÔ∏è      
    listen 80;
    server_name 45.8.97.55;

    return 301 https://$host$request_uri;
}

server {
#—Å–ª—É—à–∞–µ–º
    listen 443 ssl;
    server_name 45.8.97.55;

#—É–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∏ –∫–ª—é—á—É    
    ssl_certificate /root/Itmo-DevOps-Cloud/lab1/web_server/ssl/nginx.crt;
    ssl_certificate_key /root/Itmo-DevOps-Cloud/lab1/web_server/ssl/nginx.key;

#—É–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ –Ω–∞—à–µ–º—É html —Ñ–∞–π–ª—É
    location / {
        alias /root/Itmo-DevOps-Cloud/lab1/site2/;
        index second.html;
    }

#–æ—Ç—á–µ—Ç –µ—Å–ª–∏ —á–µ —Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –∏–ª–∏ –Ω–µ–Ω–∞—Ö–æ–¥
    error_log /root/Itmo-DevOps-Cloud/lab1/logs/site2_error.log;
}   
```
#
–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ —Ç–µ—Å—Ç–∏–º –µ–≥–æ `nginx -t` –Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏, –µ—Å–ª–∏ –≤—Å–µ successful, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º—Å—è `systemctl restart nginx`

–í –¥–µ—Ä–∏–∫—Ç–æ—Ä–∏–∏ –Ω–∞—à–µ–π –ª–∞–±—ã :
`git add .`
`git commit -m "dobavil che to"`
`git push origin main`

#### –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è

![](/lab1/media/first.png)
#
![](/lab1/media/second.png)

as u can see - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

# –ò—Ç–æ–≥–∏
–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª–æ –¥–æ–≤–æ–ª—å–Ω–æ –º–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å. –ù–µ –º–æ–≥–ª–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –ª–æ–∫–µ–π—à–∏–Ω–æ–º –∏ –≤–æ–æ–±—â–µ —Å —Ç–µ–º, —á—Ç–æ –æ—Ç –Ω–∞—Å —Ö–æ—Ç—è—Ç. –ù–æ –≤ –∏—Ç–æ–≥–µ –ø–æ—Å–∏–¥–µ–≤ –∏ —Ä–∞–∑–æ–±—Ä–∞–≤—à–∏—Å—å –≤—Ä–æ–¥–µ –∫–∞–∫ –ø–æ–Ω—è–ª–∏ —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å. 
–ú—ã –∑–∞–¥–µ–ø–ª–æ–∏–ª–∏ –¥–≤–∞ html –Ω–∞ –≤–µ–± —Å–µ—Ä–≤–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –¥–≤–∞ ip (–Ω–µ –¥–æ–º–µ–Ω–∞, –∏–∑–≤–∏–Ω–∏—Ç–µüí∏üö´) —Å ssl —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç alias –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ –ø—É—Ç–µ–π –∫ html's –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç 80 –ø–æ—Ä—Ç –Ω–∞ 443.

–î–æ–º–µ–Ω –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å/–æ—Ç–∫—Ä—ã—Ç—å `nano etc/hosts`, –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞—à–∏ ip's –∏ –ø—Ä–∏–ø–∏—Å–∞—Ç—å –∏–º –∏–º–µ–Ω–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ø–æ–º–µ–Ω—è—Ç—å –∞–π–ø–∏—à–Ω–∏–∫–∏ –Ω–∞ –¥–æ–º–µ–Ω—ã. –ü–µ—Ä–µ–π—Ç–∏ –ø–æ –¥–æ–º–µ–Ω—É –ø–æ–ª—É—á–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.